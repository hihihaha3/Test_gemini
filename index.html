<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá Th·ªëng AR S·ªë H√≥a - ƒêinh Quang Trung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; }
        .camera-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transform: scaleX(-1); z-index: 0; opacity: 0.5; filter: grayscale(30%);
        }
        #input_video { display: none; }
        .glass-panel {
            background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px;
        }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: #00ffff;
        }
        .start-btn {
            margin-top: 20px; padding: 15px 40px; background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff; color: #00ffff; font-weight: bold; border-radius: 50px;
            transition: 0.3s;
        }
        .start-btn:hover { background: #00ffff; color: #000; box-shadow: 0 0 30px #00ffff; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 class="text-3xl font-bold mb-2 tracking-widest">DIGITAL AR SYSTEM</h1>
        <p class="text-gray-400 text-sm mb-8">User: ƒêinh Quang Trung</p>
        <button id="btn-start" class="start-btn animate-bounce" onclick="startSystem()">
            K√çCH HO·∫†T H·ªÜ TH·ªêNG
        </button>
        <div id="error-log" class="text-red-500 mt-4 hidden text-sm"></div>
    </div>

    <video id="camera_display" class="camera-bg" autoplay playsinline muted></video>
    <video id="input_video" autoplay playsinline muted></video>
    <div id="canvas-container"></div>

    <div class="absolute top-4 left-4 glass-panel p-4 text-white z-50 hidden" id="ui-panel">
        <h2 class="text-xs font-bold text-gray-400 uppercase mb-1">Tr·∫°ng th√°i c·ª≠ ch·ªâ</h2>
        <div class="flex items-center space-x-3">
            <span class="text-3xl">üñêÔ∏è</span>
            <div>
                <p class="text-xl font-bold text-cyan-400" id="gesture-result">ƒêang ch·ªù...</p>
                <p class="text-xs text-gray-300" id="hand-count-status">Ch∆∞a ph√°t hi·ªán tay</p>
            </div>
        </div>
    </div>

    <div class="absolute bottom-10 w-full text-center z-40 hidden" id="guide-text">
        <span class="bg-black/60 text-white/90 px-6 py-3 rounded-full text-lg backdrop-blur-md border border-cyan-500/30 font-semibold">
            Gi∆° c√°c ng√≥n tay (0-5) ƒë·ªÉ t·∫°o s·ªë
        </span>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const PARTICLE_COUNT = 7000;
        let currentShape = 'heart'; // H√¨nh d·∫°ng m·∫∑c ƒë·ªãnh ban ƒë·∫ßu
        let lastDetectedNumber = -1;
        
        // --- THREE.JS SETUP ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 22;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // Texture h·∫°t (t·∫°o ƒë·ªëm s√°ng)
        const canvas = document.createElement('canvas');
        canvas.width = 64; canvas.height = 64;
        const ctx = canvas.getContext('2d');
        const grad = ctx.createRadialGradient(32,32,0,32,32,32);
        grad.addColorStop(0, 'rgba(255,255,255,1)');
        grad.addColorStop(0.4, 'rgba(0,255,255,0.8)');
        grad.addColorStop(1, 'transparent');
        ctx.fillStyle = grad; ctx.fillRect(0,0,64,64);
        const texture = new THREE.Texture(canvas); texture.needsUpdate = true;

        const geometry = new THREE.BufferGeometry();
        const pos = new Float32Array(PARTICLE_COUNT * 3);
        const targetPos = new Float32Array(PARTICLE_COUNT * 3);
        
        for(let i=0; i<PARTICLE_COUNT*3; i++) {
            pos[i] = (Math.random()-0.5)*100; // V·ªã tr√≠ ban ƒë·∫ßu bay lung tung
            targetPos[i] = pos[i];
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        const material = new THREE.PointsMaterial({ size: 0.3, map: texture, transparent: true, opacity: 0.9, blending: THREE.AdditiveBlending, depthWrite: false });
        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        // --- H√ÄM T·∫†O H√åNH D√ÅNG (C·ªët l√µi m·ªõi) ---
        function calcTargets(shape) {
            const scale = 0.8;
            for(let i=0; i<PARTICLE_COUNT; i++) {
                let x=0, y=0, z=0; const idx=i*3;
                const t = Math.random(); // Bi·∫øn ng·∫´u nhi√™n ƒë·ªÉ r·∫£i h·∫°t d·ªçc theo n√©t
                const section = i / PARTICLE_COUNT; // Bi·∫øn ƒë·ªÉ chia h·∫°t v√†o c√°c n√©t kh√°c nhau

                if(shape === 'heart') {
                    const a = Math.random()*Math.PI*2, r=Math.random();
                    x = 16*Math.pow(Math.sin(a),3)*scale*r; y=(13*Math.cos(a)-5*Math.cos(2*a)-2*Math.cos(3*a)-Math.cos(4*a))*scale*r; z=(Math.random()-0.5)*5;
                } 
                // --- C√ÅC CON S·ªê T·ª™ 0 ƒê·∫æN 5 ---
                else if(shape === 'num0') { // S·ªë 0: H√¨nh elip ƒë·ª©ng
                    const a = Math.random() * Math.PI * 2;
                    x = 6 * Math.cos(a); y = 8 * Math.sin(a); z = (Math.random()-0.5)*2;
                }
                else if(shape === 'num1') { // S·ªë 1: ƒê∆∞·ªùng th·∫≥ng ƒë·ª©ng
                    x = 0 + (Math.random()-0.5); y = (t - 0.5) * 16; z = (Math.random()-0.5)*2;
                }
                else if(shape === 'num2') { // S·ªë 2: 3 n√©t (Cong tr√™n, Ch√©o xu·ªëng, Ngang ƒë√°y)
                    if(section < 0.4) { // N√©t cong tr√™n
                        const a = Math.PI - (t * Math.PI * 0.8); // G√≥c t·ª´ 180 xu·ªëng
                        x = 5 * Math.cos(a); y = 4 + 4 * Math.sin(a);
                    } else if (section < 0.75) { // N√©t ch√©o
                        x = 5 * (1-t) - 4*t; y = 4 * (1-t) - 7*t; // N·ªôi suy t·ª´ g√≥c tr√™n xu·ªëng g√≥c d∆∞·ªõi
                    } else { // N√©t ngang ƒë√°y
                        x = -4 + t * 8; y = -7;
                    }
                    z = (Math.random()-0.5)*2;
                }
                else if(shape === 'num3') { // S·ªë 3: 2 n√©t cong n·ªëi nhau
                    const a = Math.PI/2 - (t * Math.PI); // G√≥c b√°n nguy·ªát b√™n ph·∫£i
                    if(section < 0.5) { x = 5 * Math.cos(a); y = 4 + 4 * Math.sin(a); } // Cong tr√™n
                    else { x = 5 * Math.cos(a); y = -4 + 4 * Math.sin(a); } // Cong d∆∞·ªõi
                    z = (Math.random()-0.5)*2;
                }
                else if(shape === 'num4') { // S·ªë 4: 3 n√©t th·∫≥ng
                     if(section < 0.3) { x = -4; y = 0 + t * 8; } // D·ªçc tr√°i ng·∫Øn
                     else if (section < 0.6) { x = -4 + t * 8; y = 0; } // Ngang gi·ªØa
                     else { x = 4; y = (t-0.5)*16; } // D·ªçc ph·∫£i d√†i
                     z = (Math.random()-0.5)*2;
                }
                else if(shape === 'num5') { // S·ªë 5: Ngang tr√™n, d·ªçc xu·ªëng, cong d∆∞·ªõi
                    if(section < 0.3) { x = 4 - t * 8; y = 7; } // Ngang tr√™n
                    else if (section < 0.5) { x = -4; y = 7 - t*7; } // D·ªçc xu·ªëng
                    else { // Cong d∆∞·ªõi
                        const a = Math.PI - (t * Math.PI * 1.2);
                         x = -4 + 5 * Math.cos(a) + 4; y = 0 + 5 * Math.sin(a);
                    }
                    z = (Math.random()-0.5)*2;
                }

                targetPos[idx]=x * scale * 1.5; // Scale to l√™n ch√∫t cho d·ªÖ nh√¨n
                targetPos[idx+1]=y * scale * 1.5; 
                targetPos[idx+2]=z;
            }
        }
        // T√≠nh to√°n h√¨nh ban ƒë·∫ßu
        calcTargets(currentShape);

        // --- H√ÄM ƒê·∫æM NG√ìN TAY (AI C·ª≠ ch·ªâ) ---
        function isFingerUp(landmarks, tipIdx, jointIdx) {
             const wrist = landmarks[0];
             const tip = landmarks[tipIdx];
             const joint = landmarks[jointIdx];
             // So s√°nh kho·∫£ng c√°ch b√¨nh ph∆∞∆°ng t·ª´ c·ªï tay
             const distTip = (tip.x-wrist.x)**2 + (tip.y-wrist.y)**2;
             const distJoint = (joint.x-wrist.x)**2 + (joint.y-wrist.y)**2;
             // N·∫øu ƒë·∫ßu ng√≥n xa c·ªï tay h∆°n kh·ªõp gi·ªØa -> Ng√≥n ƒëang du·ªói
             // H·ªá s·ªë 1.1 ƒë·ªÉ t·∫°o ng∆∞·ª°ng an to√†n, tr√°nh nh·∫≠n di·ªán sai khi ng√≥n h∆°i cong
             return distTip > distJoint * 1.15;
        }

        function countExtendedFingers(lm) {
             let count = 0;
             // Thumb (ng√≥n c√°i): so kh·ªõp 4 vs kh·ªõp 2 (g·∫ßn g·ªëc ng√≥n c√°i)
             if(isFingerUp(lm, 4, 2)) count++;
             // Index (tr·ªè): 8 vs 6
             if(isFingerUp(lm, 8, 6)) count++;
             // Middle (gi·ªØa): 12 vs 10
             if(isFingerUp(lm, 12, 10)) count++;
             // Ring (√°p √∫t): 16 vs 14
             if(isFingerUp(lm, 16, 14)) count++;
             // Pinky (√∫t): 20 vs 18
             if(isFingerUp(lm, 20, 18)) count++;
             return count;
        }

        // --- X·ª¨ L√ù MEDIAPIPE ---
        function onResults(results) {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('ui-panel').style.display = 'block';
            document.getElementById('guide-text').style.display = 'block';

            let handStatusText = "Kh√¥ng th·∫•y tay";
            let gestureText = "--";

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                // L·∫•y b√†n tay ƒë·∫ßu ti√™n ph√°t hi·ªán ƒë∆∞·ª£c
                const landmarks = results.multiHandLandmarks[0];
                handStatusText = "ƒê√£ ph√°t hi·ªán 1 tay";

                // ƒê·∫øm s·ªë ng√≥n tay ƒëang gi∆°
                const fingerCount = countExtendedFingers(landmarks);
                gestureText = `S·ªë: ${fingerCount}`;

                // N·∫øu s·ªë ng√≥n tay thay ƒë·ªïi so v·ªõi l·∫ßn tr∆∞·ªõc, c·∫≠p nh·∫≠t h√¨nh d√°ng h·∫°t
                if (fingerCount !== lastDetectedNumber && fingerCount <= 5) {
                    currentShape = `num${fingerCount}`;
                    calcTargets(currentShape); // T√≠nh to√°n v·ªã tr√≠ m·ªõi cho c√°c h·∫°t
                    lastDetectedNumber = fingerCount;
                    
                    // Hi·ªáu ·ª©ng m√†u s·∫Øc nh·∫π khi ƒë·ªïi s·ªë
                    material.color.setHSL(fingerCount / 5, 1.0, 0.5); 
                }
            } else {
                // N·∫øu kh√¥ng th·∫•y tay, quay v·ªÅ h√¨nh tr√°i tim m·∫∑c ƒë·ªãnh sau m·ªôt l√∫c
                if (lastDetectedNumber !== -1) {
                     currentShape = 'heart';
                     calcTargets('heart');
                     lastDetectedNumber = -1;
                     material.color.setHex(0x00ffff); // Reset m√†u
                }
            }

            // C·∫≠p nh·∫≠t UI
            document.getElementById('hand-count-status').innerText = handStatusText;
            document.getElementById('gesture-result').innerText = gestureText;
        }

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.6 });
        hands.onResults(onResults);

        // --- KH·ªûI ƒê·ªòNG CAMERA ---
        async function startSystem() {
            const btn = document.getElementById('btn-start');
            btn.innerText = "ƒêANG K·∫æT N·ªêI..."; btn.classList.remove('animate-bounce');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: 640, height: 480 } });
                document.getElementById('camera_display').srcObject = stream;
                const videoInput = document.getElementById('input_video');
                videoInput.srcObject = stream;
                const cam = new Camera(videoInput, {
                    onFrame: async () => { await hands.send({image: videoInput}); },
                    width: 640, height: 480
                });
                cam.start();
            } catch (err) {
                btn.innerText = "L·ªñI CAMERA";
                document.getElementById('error-log').innerText = "Kh√¥ng th·ªÉ truy c·∫≠p camera. H√£y ki·ªÉm tra quy·ªÅn ho·∫∑c d√πng HTTPS.";
                document.getElementById('error-log').classList.remove('hidden');
            }
        }

        // --- LOOP ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            const posAttr = geometry.attributes.position;
            const arr = posAttr.array;
            
            particles.rotation.y += 0.002; // Xoay nh·∫π cho sinh ƒë·ªông

            for(let i=0; i<PARTICLE_COUNT; i++) {
                const idx=i*3;
                // Di chuy·ªÉn h·∫°t v·ªÅ v·ªã tr√≠ ƒë√≠ch (Lerp)
                // T·ªëc ƒë·ªô di chuy·ªÉn (0.08) c√†ng cao th√¨ h·∫°t bay v·ªÅ c√†ng nhanh
                arr[idx] += (targetPos[idx] - arr[idx]) * 0.08;
                arr[idx+1] += (targetPos[idx+1] - arr[idx+1]) * 0.08;
                arr[idx+2] += (targetPos[idx+2] - arr[idx+2]) * 0.08;
            }
            posAttr.needsUpdate = true;
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
        </div>
    </div>

    <div class="absolute bottom-6 w-full text-center z-40 hidden" id="guide-text">
        <span class="bg-black/60 text-white/80 px-4 py-2 rounded-full text-sm backdrop-blur-md border border-white/10">
            Gi∆° <b>2 tay</b> l√™n tr∆∞·ªõc camera ƒë·ªÉ ƒëi·ªÅu khi·ªÉn
        </span>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        const PARTICLE_COUNT = 6000; // Gi·∫£m nh·∫π s·ªë h·∫°t cho m∆∞·ª£t mobile
        let currentShape = 'heart';
        
        // --- THREE.JS ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 20;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // Texture h·∫°t
        const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32;
        const ctx = canvas.getContext('2d');
        const grad = ctx.createRadialGradient(16,16,0,16,16,16);
        grad.addColorStop(0, 'white');
        grad.addColorStop(1, 'transparent');
        ctx.fillStyle = grad; ctx.fillRect(0,0,32,32);
        const texture = new THREE.Texture(canvas); texture.needsUpdate = true;

        // T·∫°o h·∫°t
        const geometry = new THREE.BufferGeometry();
        const pos = new Float32Array(PARTICLE_COUNT * 3);
        const targetPos = new Float32Array(PARTICLE_COUNT * 3);
        
        for(let i=0; i<PARTICLE_COUNT*3; i++) {
            pos[i] = (Math.random()-0.5)*50;
            targetPos[i] = pos[i];
        }
        geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        const material = new THREE.PointsMaterial({ size: 0.15, map: texture, transparent: true, opacity: 0.8, color: 0x00ffff, blending: THREE.AdditiveBlending, depthWrite: false });
        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        // H√†m t·∫°o h√¨nh (R√∫t g·ªçn)
        function calcTargets(shape) {
            const scale = 0.6;
            for(let i=0; i<PARTICLE_COUNT; i++) {
                let x,y,z; const idx=i*3;
                if(shape === 'heart') {
                    const t = Math.random()*Math.PI*2, r = Math.random();
                    x = 16*Math.pow(Math.sin(t),3) * scale * r;
                    y = (13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t)) * scale * r;
                    z = (Math.random()-0.5)*4 * scale;
                } else if(shape === 'planet') {
                    const angle = Math.random()*Math.PI*2, rad = 8 + Math.random();
                    x=rad*Math.cos(angle); z=rad*Math.sin(angle); y=(Math.random()-0.5)*2;
                } else { // Lotus default
                     const layer = i%3, t = Math.random(), ang = Math.random()*Math.PI*2;
                     const r = (2 + layer*2) + t*4;
                     x=r*Math.cos(ang); z=r*Math.sin(ang); y=t*t*5 - 2;
                }
                targetPos[idx]=x; targetPos[idx+1]=y; targetPos[idx+2]=z;
            }
        }
        calcTargets('heart');
        function changeShape(s) { currentShape=s; calcTargets(s); }

        // --- MEDIAPIPE HANDS ---
        let handScale = 1.0;
        let isHandDetected = false;

        function onResults(results) {
            // ·∫®n m√†n h√¨nh ch·ªù khi AI ƒë√£ ch·∫°y ok
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('ui-panel').style.display = 'block';
            document.getElementById('guide-text').style.display = 'block';

            if (results.multiHandLandmarks && results.multiHandLandmarks.length === 2) {
                isHandDetected = true;
                const h1 = results.multiHandLandmarks[0][8];
                const h2 = results.multiHandLandmarks[1][8];
                const dist = Math.sqrt(Math.pow(h1.x-h2.x, 2) + Math.pow(h1.y-h2.y, 2));
                
                // C·∫≠p nh·∫≠t scale d·ª±a v√†o kho·∫£ng c√°ch 2 tay
                const targetScale = Math.max(0.2, Math.min(5.0, dist * 5));
                handScale += (targetScale - handScale) * 0.1;

                document.getElementById('hand-status').innerHTML = '<span class="text-green-400">ƒê√£ k·∫øt n·ªëi</span>';
                document.getElementById('dist-val').innerText = dist.toFixed(2);
            } else {
                isHandDetected = false;
                document.getElementById('hand-status').innerHTML = '<span class="text-yellow-400">C·∫ßn 2 tay...</span>';
                // T·ª± ƒë·ªông xoay khi ko c√≥ tay
                particles.rotation.y += 0.005;
                handScale += (1.0 - handScale) * 0.05;
            }
        }

        const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
        hands.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
        hands.onResults(onResults);

        // --- CAMERA SETUP ---
        async function startSystem() {
            const btn = document.getElementById('btn-start');
            const status = document.getElementById('status-msg');
            const errorLog = document.getElementById('error-log');
            
            btn.innerText = "ƒêANG K·∫æT N·ªêI...";
            status.innerText = "Requesting Camera Access...";
            
            try {
                // L·∫•y lu·ªìng camera
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: 640, height: 480 } });
                
                // G√°n v√†o th·∫ª video n·ªÅn
                const videoDisplay = document.getElementById('camera_display');
                videoDisplay.srcObject = stream;
                
                // G√°n v√†o th·∫ª video ·∫©n cho AI
                const videoInput = document.getElementById('input_video');
                videoInput.srcObject = stream;
                
                // B·∫Øt ƒë·∫ßu AI Camera Loop
                const cam = new Camera(videoInput, {
                    onFrame: async () => { await hands.send({image: videoInput}); },
                    width: 640, height: 480
                });
                cam.start();
                
                status.innerText = "H·ªá th·ªëng ƒë√£ kh·ªüi ch·∫°y...";

            } catch (err) {
                console.error(err);
                btn.innerText = "L·ªñI KH·ªûI ƒê·ªòNG";
                status.innerText = "Kh√¥ng th·ªÉ truy c·∫≠p Camera!";
                errorLog.classList.remove('hidden');
                
                if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    errorLog.innerHTML = `‚ùå L·ªói b·∫£o m·∫≠t: Tr√¨nh duy·ªát y√™u c·∫ßu <b>HTTPS</b>.<br>N·∫øu b·∫°n ƒëang m·ªü file tr·ª±c ti·∫øp, h√£y upload l√™n Netlify/GitHub Pages.`;
                } else {
                    errorLog.innerText = "‚ùå B·∫°n ƒë√£ ch·∫∑n quy·ªÅn Camera. H√£y b·∫•m v√†o bi·ªÉu t∆∞·ª£ng ·ªï kh√≥a tr√™n thanh ƒë·ªãa ch·ªâ > Reset Permission.";
                }
            }
        }

        // --- LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            const posAttr = geometry.attributes.position;
            const arr = posAttr.array;
            
            // Xoay nh·∫π theo th·ªùi gian
            if(isHandDetected) {
                particles.rotation.y += 0.002;
            }

            for(let i=0; i<PARTICLE_COUNT; i++) {
                const idx=i*3;
                let tx = targetPos[idx] * handScale;
                let ty = targetPos[idx+1] * handScale;
                let tz = targetPos[idx+2] * handScale;

                // Di chuy·ªÉn h·∫°t
                arr[idx] += (tx - arr[idx]) * 0.05;
                arr[idx+1] += (ty - arr[idx+1]) * 0.05;
                arr[idx+2] += (tz - arr[idx+2]) * 0.05;
            }
            posAttr.needsUpdate = true;
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
